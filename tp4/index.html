<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Source Themes Academic 4.8.0"><meta name=description content="Developing a RESTful Service In Service Oriented Programming a RESTful service is a service conforming to the REST (Representational State Transfer) architecture style. In this kind of architecture (i) you think in terms of resources and their representations (instead of thinking about operations, inputs and outputs), and (ii) you address and transfer resource states using the URI and HTTP standards.
When a service follows the REST architecture, every client knowing how to use HTTP can access the states and representations of the resources of a RESful service (cf."><link rel=alternate hreflang=en-us href=https://javieraespinosa.github.io/web-programming-and-services/tp4/><meta name=theme-color content="#2c66d1"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css crossorigin=anonymous title=hl-light><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark disabled><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin=anonymous async></script><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap"><link rel=stylesheet href=/web-programming-and-services/css/academic.css><link rel=manifest href=/web-programming-and-services/index.webmanifest><link rel=icon type=image/png href=/web-programming-and-services/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_2.png><link rel=apple-touch-icon type=image/png href=/web-programming-and-services/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_2.png><link rel=canonical href=https://javieraespinosa.github.io/web-programming-and-services/tp4/><meta property="twitter:card" content="summary"><meta property="og:site_name" content="Mobile and Web Services Programming"><meta property="og:url" content="https://javieraespinosa.github.io/web-programming-and-services/tp4/"><meta property="og:title" content="| Mobile and Web Services Programming"><meta property="og:description" content="Developing a RESTful Service In Service Oriented Programming a RESTful service is a service conforming to the REST (Representational State Transfer) architecture style. In this kind of architecture (i) you think in terms of resources and their representations (instead of thinking about operations, inputs and outputs), and (ii) you address and transfer resource states using the URI and HTTP standards.
When a service follows the REST architecture, every client knowing how to use HTTP can access the states and representations of the resources of a RESful service (cf."><meta property="og:image" content="https://javieraespinosa.github.io/web-programming-and-services/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_2.png"><meta property="twitter:image" content="https://javieraespinosa.github.io/web-programming-and-services/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_2.png"><meta property="og:locale" content="en-us"><title>| Mobile and Web Services Programming</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents><aside class=search-results id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=#><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/web-programming-and-services/>Mobile and Web Services Programming</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/web-programming-and-services/>Mobile and Web Services Programming</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/web-programming-and-services/#home><span>About</span></a></li><li class=nav-item><a class=nav-link href=/web-programming-and-services/#content><span>Content</span></a></li><li class=nav-item><a class=nav-link href=/web-programming-and-services/#hands-on><span>Hands on</span></a></li><li class=nav-item><a class=nav-link href=/web-programming-and-services/#bibliography><span>Bibliography</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"></ul></div></nav><article class=article><div class="article-container pt-3"><h1></h1><div class=article-metadata></div></div><div class=article-container><div class=article-style><h1 id=developing-a-restful-service>Developing a RESTful Service</h1><p>In Service Oriented Programming a RESTful service is a service conforming to the REST (<strong>Re</strong>presentational <strong>S</strong>tate <strong>T</strong>ransfer) architecture style. In this kind of architecture (i) you think in terms of <em>resources</em> and their <em>representations</em> (instead of thinking about operations, inputs and outputs), and (ii) you address and transfer <em>resource states</em> using the URI and HTTP standards.</p><p>When a service follows the REST architecture, every client knowing how to use HTTP can access the states and representations of the resources of a RESful service (cf. figure below). In this exercise you will develop a RESTful service using Javascript and NodeJS for exposing a music catalogue as a set of resources.</p><p><img src=/img/REST-Architecture.png alt="REST Architecture"></p><h2 id=requirements>Requirements</h2><ul><li><a href=http://nodejs.org/ target=_blank rel=noopener>NodeJS</a></li><li><a href=http://expressjs.com/ target=_blank rel=noopener>Express</a> (NodeJS module)</li><li><a href=http://curl.haxx.se/download.html target=_blank rel=noopener>cURL</a> or 
<a href="https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=1&ved=0CB8QFjAA&url=https%3A%2F%2Fchrome.google.com%2Fwebstore%2Fdetail%2Fpostman-rest-client%2Ffdmmgilgnpjigdojojpjoooidkmcomcm&ei=65_nVNyUGYv2UtOQhNgF&usg=AFQjCNFL71vN61QG0LKlw7VDJvIZDprjHA&sig2=Pj7vJFRZQ5Nnpl3-DqQ-0A&bvm=bv.86475890,d.d24" target=_blank rel=noopener>Postman</a> (Chrome extension)</li><li><a href=http://couchdb.apache.org/ target=_blank rel=noopener>CouchDB</a></li><li>MusicCatalog app (
<a href=/files/MusicCatalog.zip>download</a>)</li></ul><h2 id=objectives>Objectives</h2><ul><li>Implement a RESTful service and understand the use of HTTP methods for interacting with it.</li><li>Develop an application that uses your RESTful service.</li><li>Use a NoSQL database for storing the RESTful service data.</li></ul><h2 id=music-catalog-overview>Music catalog overview</h2><p>For this exercise you will use the **Music Catalog **application. The following figure illustrates its architecture (REST service and client parts).</p><p><img src=/img/Music-Catalog-Architecture.png alt="Music Catalog Architecture"></p><p>As shown in the figure, the Music Catalog service exposes two resources:</p><ul><li><strong>/albums</strong> &mdash; represents a music catalog as a collection of albums.</li><li><strong>/albums/:id</strong> &mdash; represents an album identified by <strong>:id</strong>.</li></ul><p>The figure also shows that clients and service exchange information about albums using the <strong>JSON</strong> data representation. The following diagram the structure representing an album instance.</p><p><img src=/img/Album-structure1.png alt="Album structure.png"></p><h2 id=service-behaviour>Service behaviour</h2><p>In order to implement a RESTful service you have to specify <em>what to do</em> when a client executes an HTTP operation <em>over</em> one of your resources. In web programming this is called <strong>routing</strong> (i.e. the association of a HTTP operation with a resource).</p><p>The table below summarizes the semantic of HTTP operations when executed over the Music Catalog resources.</p><table><thead><tr><th>URL</th><th>Method</th><th>Parameter</th><th>Description</th></tr></thead><tbody><tr><td>http://localhost:3000/albums</td><td>GET</td><td>&ndash;</td><td>List all the albums</td></tr><tr><td>PUT</td><td>&ndash;</td><td>Unused</td><td></td></tr><tr><td>POST</td><td>&ndash;</td><td>Unused</td><td></td></tr><tr><td>DELETE</td><td>&ndash;</td><td>Unused</td><td></td></tr><tr><td>http://localhost:3000/albums/:id</td><td>GET</td><td>&ndash;</td><td>Get the album</td></tr><tr><td>PUT</td><td>Album</td><td>Update the album</td><td></td></tr><tr><td>POST</td><td>&ndash;</td><td>Unused</td><td></td></tr><tr><td>DELETE</td><td>&ndash;</td><td>Delete the album</td><td></td></tr></tbody></table><p>In the Music Catalog REST service, these semantics are implemented by the routings specified in the <strong>CatalogService.js</strong> file. The content of this file is shown below.</p><pre><code class=language-js>var express   = require('express');
var bodyParser = require('body-parser');
var app = express();
app.use(bodyParser.json());

var albums = {};
albums['1'] = { &quot;id&quot;:1, &quot;name&quot;: 'The 2nd Law', &quot;artist&quot;: 'Muse', &quot;year&quot;: 2012 };

app.get('/albums', function (request, response) {
   response.json(albums);
});

app.get('/albums/:id', function (request, response) {
   response.json(albums[request.params.id]);
});

app.put('/albums/:id', function (request, response) {
 var album = request.body;
   albums[request.params.id] = album;
   response.json('OK');
});

app.delete('/albums/:id', function (request, response) {
 var deleted = delete albums[request.params.id];
   response.json(deleted);
});

var server = app.listen(3000, function () {
   console.log('Listening at http://localhost:%s', server.address().port);
});
</code></pre><p>As you can see, the catalog service defines routes by calling the GET/PUT/POST/DELETE methods of an <em>express object</em> (see 
<a href=http://expressjs.com/4x/api.html target=_blank rel=noopener>Express</a> for more information). For instance, the following code snippet illustrates <em>how to retrieve a specific album</em> using its ID by <strong>routing</strong> the <strong>GET</strong> operation to the resource <strong>/albums/:id</strong>.</p><pre><code>app.get('/albums/:id', function (request, response) {
   response.json(albums[request.params.id]);
});
</code></pre><p>Note that the ID of an album is <em>resolved dynamically</em> by matching the request&rsquo; URI with the string <strong>/albums/:id</strong>. Also note that you can access this value at runtime by using the object <strong>request.params</strong>. Finally note that, before sending information back to the client (i.e., the set of albums), the service transforms the <em>JavaScript object</em> containing the album information (<strong>albums[request.params.id]</strong>) into its *JSON representation *(<strong>response.json(OBJECT)</strong>).</p><p>The following code snippet illustrates how to <em>add a new album to the catalog</em> by <strong>routing</strong> a <strong>PUT</strong> operation to the resource <strong>/albums/:id</strong>.</p><pre><code>var app = express();
app.use(bodyParser.json());

app.put('/albums/:id', function (request, response) {
 var album = request.body;
   albums[request.params.id] = album;
   response.json('OK');
});
</code></pre><p>In this example the service retrieves the information about the new album by accessing the HTTP request body (<strong>request.body</strong>). Then, as in the previous example, it uses the *id *specified in the <em>album resource</em> (<strong>request.params.id</strong>) in order to store the album into the music catalog (<strong>albums[request.params.id] = album</strong>).</p><p>Recall that client and service send albums&rsquo; information using the JSON data representation. This implies that you have to <strong>ALWAYS</strong> transform a JavaScript object into JSON (and vice versa) in order to communicate. Note that in the previous example Express converts automatically the <strong>request.body</strong> to Javascript because it assumes that all body requests are represented in JSON (<strong>app.use(bodyParser.json())</strong>).</p><h2 id=testing-the-service-catalog>Testing the service catalog</h2><p>Run the Music Catalog service by executing the following command inside the Music Catalog application folder:</p><pre><code>node CatalogService
</code></pre><p>Once running, test the service by issuing the following HTTP requests with cURL (or 
<a href="https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=1&ved=0CB8QFjAA&url=https%3A%2F%2Fchrome.google.com%2Fwebstore%2Fdetail%2Fpostman-rest-client%2Ffdmmgilgnpjigdojojpjoooidkmcomcm&ei=65_nVNyUGYv2UtOQhNgF&usg=AFQjCNFL71vN61QG0LKlw7VDJvIZDprjHA&sig2=Pj7vJFRZQ5Nnpl3-DqQ-0A&bvm=bv.86475890,d.d24" target=_blank rel=noopener>Postman</a>).</p><pre><code> # GET all albums
 curl localhost:3000/albums # Add new album
 curl -X PUT localhost:3000/albums/2 -H &quot;Content-Type: application/json&quot; -d @-
 {
 &quot;id&quot;: 2,
 &quot;name&quot;: &quot;The Resistance&quot;,
 &quot;artist&quot;: &quot;Muse&quot;,
 &quot;year&quot;: 2009
 } 
 
 # Press CTRL + D
 
 # GET all albums 
 curl localhost:3000/albums
</code></pre><h2 id=service-client>Service client</h2><p>Until now you have used a third-party tool for interacting with the Music Catalog service (e.g., Web Browser, cURL, Postman). In this section you will use the Catalog Client (a JavaScript application) for sending HTTP request to the Catalog Service.</p><p>As shown in the figure below, the Catalog Client is composed of the following classes:</p><ul><li><strong>HttpClient</strong> &mdash; Offers basic operations for executing HTTP requests. The HTTP client assumes that all data is sent using JSON as the data format representation.</li><li><strong>CatalogClient</strong> &mdash; Offers operations for adding, getting, removing the albums in the Music Catalog. These operations use the HTTP Client.</li><li><strong>Run</strong> &mdash; Script illustrating the use of the Catalog Client.</li></ul><h3 id=client-architectureimgclient-architecturepng><img src=/img/Client-Architecture.png alt="Client Architecture"></h3><h3 id=http-client>HTTP client</h3><p>The following snippet shows the code of the HTTP Client class (cf. <strong>HttpClient.js</strong> file).</p><pre><code>this.GET = function(url, callback) {
   this.doRequest('GET', url, null, callback);
};
this.PUT = function (url, data, callback) {
   this.doRequest('PUT', url, data, callback);
};

this.DELETE = function (url, callback) {
   this.doRequest('DELETE', url, null, callback);
};

this.doRequest = function(verb, url, data, callback) {

   var options = {
      hostname: URL.*parse*(url).hostname,
      port:     URL.*parse*(url).port,
      path:     URL.*parse*(url).path,
      method:   verb,
      headers: {
         'Content-Type': 'application/json',
         'Content-Length': (data)? data.length: 0
      }
   };

   var req = http.request(options, function(res) {...);

 req.write( (data)? data: '');
   req.end();

};
</code></pre><p>Note that all HTTPClient operations (GET/PUT/DELETE) depend on the <strong>doRequest</strong> function, which is in charge of preparing the HTTP message: *header *(<strong>options</strong>) and <em>body</em> (<strong>req.write(data)</strong>). Also note that <strong>doRequest</strong> assumes that all content (<strong>data</strong>) sent by the HTTPClient is represented in JSON (<strong>&lsquo;Content-Type: application/json&rsquo;</strong>).</p><h3 id=catalog-client>Catalog client</h3><p>The following snippet illustrates the use of the <strong>HttpClient</strong> for <em>adding</em> and *getting *an album (cf. <strong>CatalogClient.js</strong>).</p><pre><code>var ALBUMS_URI = 'http://localhost:3000/albums';
var ALBUM_URI = 'http://localhost:3000/albums/{_}';
var http = new HttpClient();

this.addAlbum = function (album, callback) {
   var url = ALBUM_URI.replace('{_}', album.id);
   var data = JSON.stringify(album);
   http.PUT(url, data, callback)
};

this.getAlbum = function (albumID, callback) {
   var url = ALBUM_URI.replace('{_}', albumID);
   http.GET(url, function (resp) {
      var album = JSON.parse(resp.body);
      callback(album);
   });
};
</code></pre><p>Note that before adding a <em>new album</em> into the catalog (using <strong>http.PUT</strong>), the <strong>addAlbum</strong> function converts the album JavaScript object into JSON using the <strong>JSON.stringify()</strong>. In a similar way, when the <strong>getAlbum</strong> function receives the response from the service, it uses the <strong>JSON.parse</strong>function for converting the <strong>response body</strong> (sent in JSON format) into a JavaScript object.</p><h3 id=run-script>Run script</h3><p>Finally the following code illustrates the use of the CatalogClient class for *adding, retrieving and removing *albums programmatically (cf. <strong>Run.js</strong> file).</p><pre><code>   /// Step 0: Show the albums in the catalog
    .then(function (next) {
        client.getAlbums(function (albums) {
            console.log('\n'+'ALBUMS (before insertion)');
            console.log(albums);
            next();
        });
    })
    /// Step 1: Insert new album in Catalog
    .then(function (next) {
        var album = { &quot;id&quot;:2, &quot;name&quot;:'The Resistance', &quot;artist&quot;:'Muse', &quot;year&quot;:2009 };
        client.addAlbum(album, function (resp) {
             next();
        });
    })
     /// Step 2: Insert another album (with errors)
    .then(function (next) {
        var album = { &quot;id&quot;: 3, &quot;name&quot;: 'XXXX', &quot;artist&quot;: 'YYYY', &quot;year&quot;: 0000 };
        client.addAlbum(album, function (resp) {
             next();
        });
    })
    /// Step 3: Show the albums in the catalog
    .then(function (next) {
        client.getAlbums(function (albums) {
            console.log('\n'+'ALBUMS (after insertions)');
            console.log(albums);
             next();
        });
    })
    /// Step 4: Remove the album with errors
    .then(function (next) {
        client.removeAlbum('3', function () {
           next();
        });
    })
    /// Step 5: Show (again) the albums in the catalog
    .then(function (next) {
        client.getAlbums(function (albums) {
            console.log('\n'+'ALBUMS (after deletion)');
            console.log(albums);
            next();
        });
    });
</code></pre><h2 id=to-do>To Do</h2><p>For this exercise you have to:</p><ul><li>Describe the characteristics of the Catalog REST service. For instance, it is stateful/stateless, persistent/non-persistent?</li><li>Implement a Deezer Client using the HTTPClient class for <em>searching</em> and <em>retrieves</em> information about albums using the 
<a href=http://developers.deezer.com/api target=_blank rel=noopener>Deezer RESTful Service</a>.</li><li>Modify the Catalog Service in order to store the Catalog in CouchDB.</li><li>Define a CouchDB view for retrieving the URLs of the albums&rsquo; covers (see 
<a href=http://guide.couchdb.org/ target=_blank rel=noopener>CouchDB: The definitive guide</a>).</li></ul></div></div></article><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin=anonymous></script><script>const code_highlighting=true;</script><script>const isSiteThemeDark=false;</script><script src=/web-programming-and-services/js/academic.min.6f7ce8be710290b8c431bbc97f405d15.js></script><div class=container><footer class=site-footer><p class=powered-by>Powered by the
<a href=https://sourcethemes.com/academic/ target=_blank rel=noopener>Academic theme</a> for
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a>.
<span class=float-right aria-hidden=true><a href=# class=back-to-top><span class=button_icon><i class="fas fa-chevron-up fa-2x"></i></span></a></span></p></footer></div><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i>Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i>Download</a><div id=modal-error></div></div></div></div></div></body></html>